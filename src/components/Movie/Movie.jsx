import React from 'react';
import { useEffect } from 'react';
import { useState } from 'react';
import { getFilmData } from '../../utils/requests';
import { MovieDesc } from '../MovieDesc/MovieDesc';
import './Movie.css';
import 'aos/dist/aos.css';
import Aos from 'aos';

export const Movie = ({ movie, onClick, getMovieDesc }) => {
    let [movieDesc, setMovieDesc] = useState(null);
    let [error, setError] = useState(null);
    let [loaded, setLoaded] = useState(false);

    const movieInfo = movie;

    const id = movie.filmId;
    const name = movie.nameRu;
    const foto = movie.posterUrl;
    const rating = movie.rating;
    const genres = movie.genres;
    const genresStr = genres.map((a) => Object.values(a)).join(', ');

    const ratingColor = rating < 5 ? '_red' : rating < 8 && rating >= 5 ? '_yellow' : '_green';
 

    /* –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
    useEffect(() => {
        Aos.init({ duration: 300 });
    }, []);

    const handleClick = () => {
        onClick(movieInfo) /* –ø–æ–¥–Ω–∏–º–∞–µ–º –Ω–∞–≤–µ—Ä—Ö –æ–±—ä–µ–∫—Ç —Å –∏–Ω—Ñ–æ–π, —á—Ç–æ–±—ã –ø–µ—Ä–µ–¥–∞—Ç—å —Ñ–æ—Ç–æ, –∏–º—è –∏ —Ç–¥ –≤ AboutFilm  */

        //–ù–∞—Å—Ç—å, –∏–∑-–∑–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –ø–æ –∫–ª–∏–∫—É –ø–æ—Ö–æ–¥—É –∏ –ø–æ—à–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ –≤ AboutFilm, –Ω–∞–≤–µ—Ä–Ω–æ–µ, –ª—É—á—à–µ —Å–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –∏ –∑–∞–ø–∏—Å–∞—Ç—å –≤ —Å—Ç–µ–π—Ç (–ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å getMovieDesc —Å—Ç—Ä–æ–∫–∞ 47 –∑–¥–µ—Å—å).
    }

    /* –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è hover */
    const fetchAdditionalData = async (id) => { 
            try {
                const result = await getFilmData(id);
                setMovieDesc(result);
            } catch (error) {
                setError(error.message);
                // console.log('error: ', error);
            }
            setLoaded(true); 
        // console.log('movieDesc: ', movieDesc);
    }

    useEffect(() => {
        getMovieDesc(movieDesc); // –ü–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ —Ñ–∏–ª—å–º–µ –≤ —Ñ—É–Ω–∫—Ü–∏—é, —á—Ç–æ–±—ã –ø–æ–¥–Ω—è—Ç—å –∏—Ö –Ω–∞–≤–µ—Ä—Ö –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º –∏ –Ω–µ –≤—ã–∑—ã–≤–∞—Ç—å –∞–ø–∏ –∑–∞–Ω–æ–≤–æ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ —Ñ–∏–ª—å–º–∞
    })



    return (
        <div className='movie' onClick={handleClick}>
            <img alt={name} src={foto}
                data-aos='fade-zoom-in' /* –ê–Ω–∏–º–∞—Ü–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Aos */
                data-aos-delay='200'
                data-aos-offset='0'
                onMouseOver={movieDesc ? null : () => fetchAdditionalData(id)}  // –ø–æ—Å—Ç–∞–≤–∏–ª–∞ –ø—Ä–æ–≤–µ—Ä–æ—á–∫—É, —á—Ç–æ–±—ã –∑–∞–ø—Ä–æ—Å –¥–µ–ª–∞–ª—Å—è —Ç–æ–ª—å–∫–æ 1 —Ä–∞–∑ ü•∫
                className={'movie__img'}
            />
            <div className='movie__dark_hover'></div>
            <div className='movie__description'>
                <p className='movie__name text-movie'>{name}</p>
                <p className={'movie__rating' + ratingColor}>{rating}</p>
                <p className='movie__genre text-movie'>{genresStr}</p>
            </div>
            <div className={'movie__hoverDesc'}>
                <MovieDesc movieDesc={movieDesc} />
            </div>
        </div>
    );
}